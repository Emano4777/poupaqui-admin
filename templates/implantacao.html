<!DOCTYPE html>
<html lang="pt-br">
<head>
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-7995010197286628"
    crossorigin="anonymous"></script>

  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="icon" type="image/png" href="https://res.cloudinary.com/dizfq460q/image/upload/v1739487331/f5jacl8k23kajzp50qon.png" />
  <title>Implantação - PoupaAqui</title>

  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css" />

  <style>
  body, html{
    background-color: white;
    margin: 0;
    padding: 0;
    overflow-x: hidden;
  }

  /* Navbar (mesmo padrão do seu template) */
  .navbar-brand .logo-img { max-width: 80px; height: auto; }
  .navbar-custom{
    background-color: white;
    padding: 10px;
    box-shadow: 0px 4px 10px rgba(0, 0, 0, 0.1);
    display: flex;
    flex-wrap: wrap;
    justify-content: space-between;
    align-items: center;
  }
  .navbar-custom .btn-danger{
    background-color: rgb(224, 6, 40);
    border-color: rgb(224, 6, 40);
    border-radius: 20px;
    font-weight: bold;
  }

  /* Menu desktop/mobile (mesmo padrão) */
  .mobile-menu { display: none; }
  .mobile-menu-icon { font-size: 24px; cursor: pointer; }

  .mobile-menu-modal{
    display: none;
    position: fixed;
    top: 0; left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.7);
    justify-content: center;
    align-items: flex-end;
    transition: opacity 0.3s ease-in-out;
    z-index: 9999;
  }
  .mobile-menu-content{
    background: white !important;
    padding: 20px;
    border-radius: 15px 15px 0 0;
    width: 100%;
    max-width: 350px;
    text-align: center;
    max-height: 80vh;
    overflow-y: auto;
    touch-action: auto;
    box-shadow: 0px -4px 10px rgba(0, 0, 0, 0.2);
    transform: translateY(100%);
    transition: transform 0.3s ease-in-out;
    z-index: 10000;
    position: relative;
  }
  .mobile-menu-modal.show{ display: flex; opacity: 1; }
  .mobile-menu-content.show{ transform: translateY(0); }
  .mobile-menu-content::before{
    content: "";
    width: 50px;
    height: 5px;
    background: #ccc;
    border-radius: 5px;
    display: block;
    margin: 10px auto;
  }
  .mobile-menu-content a{
    display: block;
    margin: 10px 0;
    font-size: 18px;
    color: black !important;
    text-decoration: none;
    font-weight: bold;
  }
  .mobile-menu-content .close-btn{
    position: absolute;
    top: 10px;
    right: 15px;
    font-size: 13px;
    font-weight: bold;
    cursor: pointer;
    color: rgb(224, 6, 40);
    padding: 4px 8px;
    border: none;
    border-radius: 5px;
    background: transparent;
  }
  @media (max-width: 768px){
    .desktop-menu{ display:none; }
    .mobile-menu{ display:flex; align-items:center; }
    .mobile-licenciado{ margin: 0 auto; display:flex; justify-content:center; align-items:center; }
  }
  @media (min-width: 769px){
    .mobile-menu-modal{ display:none !important; }
  }

  /* Links do menu */
  .menu-link{
    color: inherit;
    text-decoration: none;
    padding: 5px 10px;
    border-radius: 5px;
    transition: background-color 0.3s ease-in-out, color 0.3s ease-in-out;
  }
  .menu-link:hover{
    color: white !important;
    background-color: #d80000 !important;
    padding: 5px 10px;
    border-radius: 5px;
  }

  /* Botão "Unidades" igual */
  .btn-unidades{
    background-color: transparent;
    color: #d80000;
    font-weight: bold;
    text-decoration: none;
    padding: 8px 15px;
    border-radius: 20px;
    transition: 0.3s;
    display: inline-block;
  }
  .btn-unidades:hover{
    background-color: #d80000;
    color: white;
  }

  /* Título */
  h2{
    font-size: 28px;
    font-weight: bold;
    text-align: center;
    color: #d80000;
    text-transform: uppercase;
    letter-spacing: 1px;
    margin-bottom: 20px;
    position: relative;
  }
  h2::after{
    content: "";
    display: block;
    width: 60px;
    height: 4px;
    background-color: #d80000;
    margin: 10px auto 0;
    border-radius: 5px;
  }
/* ===== MAPA IMPLANTAÇÃO (IMG REAL + BOTÕES) ===== */

.implant-wrap{
  width: min(1200px, 100%);
  margin: 18px auto 10px;
}

/* container que define o "palco" exatamente do tamanho da imagem */
.implant-map{
  position: relative;
  width: 100%;
}

/* a imagem manda na altura (nada de clamp, nada de background-size) */
.implant-bg{
  width: 100%;
  height: auto;
  display: block;
  user-select: none;
  pointer-events: none;
}



/* botão circular clicável */
.implant-btn{
  position: absolute;
  left: var(--x);
  top: var(--y);
  transform: translate(-50%, -50%);
  width: clamp(52px, 5.8vw, 92px);
  height: clamp(52px, 5.8vw, 92px);
  border-radius: 50%;
  border: none;
  font-weight: 900;
  font-size: clamp(20px, 2.2vw, 34px);
  cursor: pointer;
  box-shadow: 0 12px 26px rgba(0,0,0,0.25);
  z-index: 5;

  /* ✅ efeito */
  transition: transform .18s ease, box-shadow .18s ease, filter .18s ease;
  will-change: transform;
}

.implant-btn:hover{
  /* ✅ mantém centralizado e dá zoom */
  transform: translate(-50%, -50%) scale(1.10);
  box-shadow: 0 18px 40px rgba(0,0,0,0.30);
  filter: brightness(1.03);
}

/* ✅ opcional: dá feedback no clique */
.implant-btn:active{
  transform: translate(-50%, -50%) scale(1.08);
}

.implant-node{ z-index: 6; }
.implant-node:hover{ z-index: 20; } /* o item em hover vai pra frente */

.implant-red{ background:#d80000; color:#ffd400; }
.implant-yellow{ background:#ffd400; color:#d80000; }

.implant-btn:hover::after{ opacity: 1; }
/* ===== MOBILE: usa lista, sem mapa ===== */
.implant-list{ display:none; }

@media (max-width: 720px){
  .implant-wrap{ display:none !important; }
  .implant-list{ display:block !important; padding: 8px 8px 0; }

  .implant-item{
    display:flex;
    align-items:center;
    gap:12px;
    padding: 10px 8px;
    border: 1px solid rgba(0,0,0,0.08);
    border-radius: 12px;
    margin: 10px 0;
  }

  /* botão na lista precisa ser "normal", não absolute */
  .implant-item .implant-btn{
    position: relative !important;
    left: auto !important;
    top: auto !important;
    transform: none !important;
    width: 56px;
    height: 56px;
    font-size: 22px;
    flex: 0 0 56px;
  }

  /* no mobile não usa label flutuante */
  .implant-label{ display:none !important; }
}

/* ===== TITULO VISIVEL AO LADO DA BOLA ===== */
.implant-node{
  position: absolute;
  left: var(--x);
  top: var(--y);
  transform: translate(-50%, -50%);
  z-index: 6;
}

/* botão agora não precisa mais ser absolute */
.implant-node .implant-btn{
  position: relative;
  left: auto;
  top: auto;
  transform: none;
}
.implant-label{
  position: absolute;
  top: 50%;
  transform: translateY(-50%);
  background: rgba(255,255,255,.96);
  color: #111;
  font-weight: 900;
  text-transform: uppercase;

  font-size: clamp(9px, 0.78vw, 12px);
  line-height: 1;

  padding: 6px 10px;
  border-radius: 10px;
  box-shadow: 0 10px 24px rgba(0,0,0,.14);

  /* ✅ UMA linha e mostra tudo */
  white-space: nowrap;
  width: max-content;      /* tamanho do texto */
  max-width: 360px;        /* limite pra não virar gigante */
  overflow: visible;       /* não cortar */

  z-index: 40;
}

.implant-node.right .implant-label{
  left: calc(100% + 8px);
  text-align: left;
}

.implant-node.left .implant-label{
  right: calc(100% + 8px);
  text-align: right;
}


/* no mobile some o label (porque você já tem lista) */
@media (max-width: 720px){
  .implant-label{ display:none; }
}

  /* Footer (mesmo padrão) */
  .footer{
    width: 100%;
    text-align: center;
    padding: 15px 0;
    font-size: 14px;
    color: #666;
    background: white;
    position: relative;
    box-shadow: 0px -2px 5px rgba(0, 0, 0, 0.1);
    margin-top: 25px;
  }
  .footer p{ margin: 5px 0; }
  .footer-link{
    text-decoration: none;
    color: #d80000;
    font-weight: bold;
    transition: 0.3s;
  }
  .footer-link:hover{
    color: #b00000;
    text-decoration: underline;
  }
  .footer i{ margin-right: 5px; font-size: 16px; }
</style>
</head>

<body>

  <!-- Barra de Navegação -->
  <nav class="navbar navbar-light navbar-custom px-4 py-2">
    <a class="navbar-brand" href="{{ url_for('index') }}">
      {% if logo %}
        <img src="{{ logo }}" alt="PoupAqui Logo" class="logo-img">
      {% else %}
        <p>Logo não encontrada</p>
      {% endif %}
    </a>

    <div class="desktop-menu">
      <a href="{{ url_for('lojas') }}" class="btn-unidades">
        <i class="fas fa-store"></i> Unidades
      </a>
      <span class="me-3"><i class="fas fa-tags"></i> Ofertas</span>
      <a href="{{ url_for('vitnatu') }}" class="me-3 menu-link">
        <i class="fas fa-leaf"></i> VitNatu
      </a>
      <a href="{{ url_for('sobre_nos') }}" class="me-3 menu-link">
        <i class="fas fa-info-circle"></i> Sobre Nós
      </a>
      <button class="btn btn-danger" onclick="window.open('https://farmaciaspoupaqui.com.br/?utm_source=Trafego_Direto&utm_medium=site&utm_campaign=Direto_Site', '_blank')">
        <i class="fas fa-user-plus"></i> Seja um Licenciado
      </button>
    </div>

    <div class="mobile-menu">
      <span class="mobile-menu-icon" onclick="openMobileMenu()">☰</span>
    </div>
  </nav>

  <!-- Modal do Menu Mobile -->
  <div class="mobile-menu-modal" id="mobileMenuModal">
    <div class="mobile-menu-content">
      <a href="{{ url_for('lojas') }}" class="btn-unidades">
        <i class="fas fa-store"></i> Unidades
      </a>
      <a href="#"><i class="fas fa-tags"></i> Ofertas</a>
      <a href="{{ url_for('vitnatu') }}" class="me-3 menu-link">
        <i class="fas fa-leaf"></i> VitNatu
      </a>
      <a href="{{ url_for('sobre_nos') }}" class="me-3 menu-link">
        <i class="fas fa-info-circle"></i> Sobre Nós
      </a>
      <button class="btn btn-danger mobile-licenciado" onclick="window.open('https://farmaciaspoupaqui.com.br/?utm_source=Trafego_Direto&utm_medium=site&utm_campaign=Direto_Site', '_blank')">
        <i class="fas fa-user-plus"></i> Seja um Licenciado
      </button>
      <button class="close-btn" onclick="closeMobileMenu()"><i class="fas fa-times-circle"></i></button>
    </div>
  </div>

  <div class="container py-4">
   <div class="container py-4">
 <h2>Implantação</h2>

<!-- ======= MAPA (DESKTOP/TABLET) ======= -->
<div class="implant-wrap">
  <div class="implant-map" id="implantMap">
    <img
      class="implant-bg"
      src="https://res.cloudinary.com/dizfq460q/image/upload/v1767124854/FUNDO_IMPLANTA%C3%87%C3%83O_tg83ut.png"
      alt="Mapa de Implantação"
      draggable="false"
    />

    {% for e in etapas|sort(attribute='numero') %}

      {# Coordenadas (em %) calibradas para a imagem #}
        {% if e.numero == 1 %}
      {% set x, y = '10.38%', '18.05%' %}
    {% elif e.numero == 2 %}
      {% set x, y = '36.10%', '21.25%' %}
    {% elif e.numero == 3 %}
      {% set x, y = '28.37%', '32.68%' %}
    {% elif e.numero == 4 %}
      {% set x, y = '36.18%', '42.85%' %}
    {% elif e.numero == 5 %}
      {% set x, y = '28.45%', '54.14%' %}
    {% elif e.numero == 6 %}
      {% set x, y = '36.18%', '65.31%' %}
    {% elif e.numero == 7 %}
      {% set x, y = '28.37%', '76.61%' %}

    {% elif e.numero == 8 %}
      {% set x, y = '69.82%', '76.61%' %}
    {% elif e.numero == 9 %}
      {% set x, y = '61.54%', '65.58%' %}
    {% elif e.numero == 10 %}
      {% set x, y = '69.82%', '54.28%' %}
    {% elif e.numero == 11 %}
      {% set x, y = '61.59%', '43.72%' %}
    {% elif e.numero == 12 %}
      {% set x, y = '70.25%', '32.55%' %}
    {% elif e.numero == 13 %}
      {% set x, y = '61.74%', '21.25%' %}
    {% elif e.numero == 14 %}
      {% set x, y = '89.32%', '18.05%' %}
    {% else %}
      {% set x, y = '50%', '50%' %}
    {% endif %}

    {# ✅ LADO DO LABEL (anti-colisão) #}
{# ✅ LADO DO LABEL (ajustado pra não conflitar) #}
{% if e.numero in [1,3,5,7] %}
  {% set side = 'left' %}        {# coluna esquerda → label pra fora (esquerda) #}
{% elif e.numero in [2,4,6] %}
  {% set side = 'right' %}       {# coluna esquerda → label pra dentro (direita) #}
{% elif e.numero in [8,10,12,14] %}
  {% set side = 'right' %}       {# coluna direita → label pra fora (direita) #}
{% elif e.numero in [9,11,13] %}
  {% set side = 'right' %}        {# coluna direita → label pra dentro (esquerda) #}
{% else %}
  {% set side = 'right' %}
{% endif %}



<div class="implant-node {{ side }}" style="--x: {{ x }}; --y: {{ y }};">
  <button
    class="implant-btn {{ 'implant-red' if e.cor == 'red' else 'implant-yellow' }}"
    data-bs-toggle="modal"
    data-bs-target="#modalEtapa"
    data-numero="{{ e.numero }}"
    data-titulo="{{ e.titulo }}"
    data-descricao="{{ e.descricao }}"
    type="button"
  >
    {{ e.numero }}
  </button>

  <div class="implant-label">{{ e.titulo }}</div></div>

    {% endfor %}
  </div>
</div>

<!-- ======= MOBILE (LISTA) ======= -->
<div class="implant-list">
  {% for e in etapas|sort(attribute='numero') %}
    <div class="implant-item">
      <button
        class="implant-btn {{ 'implant-red' if e.cor == 'red' else 'implant-yellow' }}"
        data-bs-toggle="modal"
        data-bs-target="#modalEtapa"
        data-numero="{{ e.numero }}"
        data-titulo="{{ e.titulo }}"
        data-descricao="{{ e.descricao }}"
        type="button"
      >
        {{ e.numero }}
      </button>
      <div style="font-weight:900; text-transform:uppercase;">
        {{ e.titulo }}
      </div>
    </div>
  {% endfor %}
</div>

  <!-- Modal Bootstrap (popup da etapa) -->
  <div class="modal fade" id="modalEtapa" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="modalEtapaTitle">Etapa</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Fechar"></button>
        </div>
        <div class="modal-body">
          <p id="modalEtapaDesc" style="margin:0;"></p>

          <!-- (Opcional) Adsense dentro do modal -->
          <div class="mt-3">
            <ins class="adsbygoogle"
              style="display:block"
              data-ad-client="ca-pub-7995010197286628"
              data-ad-slot="7900389281"
              data-ad-format="auto"
              data-full-width-responsive="true"></ins>
            <script>
              (adsbygoogle = window.adsbygoogle || []).push({});
            </script>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-danger" data-bs-dismiss="modal">
            <i class="fas fa-check"></i> Ok, entendi
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Rodapé -->
  <footer class="footer">
    <p>
      <a href="https://www.instagram.com/licencefarma/" target="_blank" class="footer-link">
        <i class="fab fa-instagram"></i> Conheça a licenciadora PoupAqui
      </a> |
      <a href="https://farmaciaspoupaqui.com.br/?utm_source=Trafego_Direto&utm_medium=site&utm_campaign=Direto_Site" target="_blank" class="footer-link">
        <i class="fas fa-user-plus"></i> Tenha sua loja PoupAqui
      </a>
    </p>
  </footer>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script>
(function(){
  const map = document.getElementById('implantMap');

  if(!map || !img) return;

  function applySize(){
    const w = map.getBoundingClientRect().width;
    const ratio = img.naturalHeight / img.naturalWidth;
    map.style.height = Math.round(w * ratio) + 'px';
  }

  // Calcula a área REAL da imagem dentro do contain (sem as bordas)
  function getContainedBox(containerW, containerH, imgW, imgH){
    const scale = Math.min(containerW / imgW, containerH / imgH);
    const drawW = imgW * scale;
    const drawH = imgH * scale;
    const offsetX = (containerW - drawW) / 2;
    const offsetY = (containerH - drawH) / 2;
    return { drawW, drawH, offsetX, offsetY };
  }

  function positionNodes(){
    const rect = map.getBoundingClientRect();
    const box = getContainedBox(rect.width, rect.height, img.naturalWidth, img.naturalHeight);

    document.querySelectorAll('.implant-node').forEach(node => {
      const x = parseFloat(node.dataset.x || "50"); // 0..100
      const y = parseFloat(node.dataset.y || "50"); // 0..100

      const px = box.offsetX + (x/100) * box.drawW;
      const py = box.offsetY + (y/100) * box.drawH;

      node.style.left = px + "px";
      node.style.top  = py + "px";
    });
  }

  function refresh(){
    applySize();
    positionNodes();
  }

  if (img.complete && img.naturalWidth){
    refresh();
  } else {
    img.addEventListener('load', refresh);
  }

  window.addEventListener('resize', refresh);
})();
</script>
<script>
document.addEventListener("DOMContentLoaded", () => {

  if(!img) return;

  img.style.pointerEvents = "auto"; // permite clique só no modo calibração
  img.style.cursor = "crosshair";

  img.addEventListener("click", (e) => {
    const r = img.getBoundingClientRect();
    const x = ((e.clientX - r.left) / r.width) * 100;
    const y = ((e.clientY - r.top) / r.height) * 100;

    const msg = `x='${x.toFixed(2)}%'  y='${y.toFixed(2)}%'`;
    console.log(msg);

    // copia pro clipboard
    navigator.clipboard?.writeText(msg).catch(()=>{});
  });
});
</script>

  <script>
    // ===== Modal Mobile Menu (mesmo comportamento do seu template) =====
    document.addEventListener("DOMContentLoaded", function () {
      let modal = document.getElementById("mobileMenuModal");
      let modalContent = modal.querySelector(".mobile-menu-content");
      modal.style.display = "none";

      let startY = 0;

      function openMobileMenu() {
        if (window.innerWidth <= 768) {
          modal.style.display = "flex";
          setTimeout(() => {
            modal.classList.add("show");
            modalContent.classList.add("show");
          }, 10);
          document.body.classList.add("modal-open");
        }
      }

      

      function closeMobileMenu() {
        modalContent.classList.remove("show");
        setTimeout(() => {
          modal.classList.remove("show");
          modal.style.display = "none";
          document.body.classList.remove("modal-open");
        }, 300);
      }

      modal.addEventListener("click", function (event) {
        if (!modalContent.contains(event.target)) {
          closeMobileMenu();
        }
      });

      modalContent.addEventListener("touchstart", function (event) {
        startY = event.touches[0].clientY;
      });

      modalContent.addEventListener("touchmove", function (event) {
        let moveY = event.touches[0].clientY;
        let diffY = moveY - startY;
        if (diffY > 100) closeMobileMenu();
      });

      window.openMobileMenu = openMobileMenu;
      window.closeMobileMenu = closeMobileMenu;
    });

    // ===== Modal das Etapas (preenche conteúdo dinamicamente) =====
    const modalEtapa = document.getElementById('modalEtapa');
    modalEtapa.addEventListener('show.bs.modal', function (event) {
      const btn = event.relatedTarget;
      const numero = btn.getAttribute('data-numero');
      const titulo = btn.getAttribute('data-titulo');
      const descricao = btn.getAttribute('data-descricao');

      document.getElementById('modalEtapaTitle').textContent = `Etapa ${numero} — ${titulo}`;
      document.getElementById('modalEtapaDesc').textContent = descricao;
    });
  </script>
</body>
</html>
